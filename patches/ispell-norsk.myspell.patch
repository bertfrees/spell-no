--- ispell-3.2.06/languages/norsk/Makefile.myspell	Tue Sep  5 23:50:30 2000
+++ ispell-3.2.06/languages/norsk/Makefile	Thu Nov 21 15:41:26 2002
@@ -34,7 +34,7 @@
 # Some technical variables for managing hyphen points and the header
 
 # CATNOHEADER=sed -e '/^\#/ D' -e 's/[	]*\#.*//' ${LANGUAGE}.words
-CATNOHEADER=grep -v '^\#' ${LANGUAGE}.words
+CATNOHEADER=grep -v '^\#' ${LANGUAGE}.words.plain
 ALPHASUBST=tr '-' 'î'
 STREKSUBST=tr 'î' '-'
 
@@ -116,8 +116,7 @@
 
 # In sum; It is nice if ispell can make a suggestion words like
 # `angrefrisperiode', but it consumes space and memory.
-
-COMPOUNDLIMIT=0
+COMPOUNDLIMIT=5
 
 # There is a system for selecting words to include in the Ispell
 # dictionary.  Unfortunately it is rather complex and not too easy to
@@ -219,6 +218,8 @@
 
 all: norsk.hash nynorsk.hash
 
+myspell: norsk-myspell.aff norsk-myspell.dic nynorsk-myspell.aff nynorsk-myspell.dic 
+
 install: install-norsk install-nynorsk install-scripts
 
 install-norsk install-nynorsk: install-%: %.hash $(CONFIG)
@@ -269,7 +270,31 @@
 	echo -e 'suffixes\nflag *z:\nY Y Y Y Y   >   YYYYYY' >> $@
 
 norsk.words: norsk.words.sq
-	unsq < norsk.words.sq > norsk.words
+	PATH=$(PATHADDER):$$PATH; \
+	export PATH; unsq < norsk.words.sq > norsk.words
+
+# MySpell support (6 Jun 2002, toralf@kscanners.com)
+# *** FIXME: Also generate "TRY" line
+%-myspell.aff: %.aff
+	echo "SET ISO8859-1" > $@
+	echo "TRY aerndtislogmkpbhfjuvæcøåyqxzvwéèóôôçî" >> $@
+	perl iaff2myaff.perl $< >> $@
+
+# Note: mch.cnt is secondary output from buildhash
+norsk.mch.cnt nynorsk.mch.cnt: %.mch.cnt: %.hash
+
+norsk-myspell.dic nynorsk-myspell.dic: %-myspell.dic : %.mch.cnt %.mch 
+	cat $^ > $@
+
+# Create a version of wordlist that is free of comments etc. and sorted
+# the same way as generated data. It will be used when calling 'join'
+# to merge wordlist with other data, as the utility would sometimes
+# get confused when original was passed. (6 Jun 2002, toralf@kscanners.com)
+# *** Hack: Word "i" is missing from bokmål and nynorsk, "å" from bokmål
+#           only. Do tricks here to get them included...
+
+%.words.plain: %.words
+	(sed -e "s/#.*//" -e "s/^å .*/å * 31 B/" $< | egrep -v "^[[:space:]]*$$"; echo "i * 31 B") | sort > $@
 
 # The following ugly code munches a part of the base file, keeping the
 # indications of the frequency of the words.  It also removes some
@@ -277,7 +302,7 @@
 # improved.
 
 
-munched.%: norsk.words norsk.aff.munch norsk.munch.hash
+munched.%: norsk.words.plain norsk.aff.munch norsk.munch.hash
 # The first pipe produces a list of all words in the % category, with
 # each root word followed by one line for each flag containing the
 # root word and the flag.  The prefix flags are treated as part of the
@@ -345,7 +370,7 @@
 	  | sed -e 's/^[-${CH}]\+ //' -e 's/î/-/g' \
 	  | awk --source '{i=0; while (i<NF) {i=i+1;print $$i,NR}}' \
 	  | sort \
-	  | join - ${LANGUAGE}.words \
+	  | join - ${LANGUAGE}.words.plain \
 	  | sed -e 's/\* //' \
 	  | cut -d ' ' -f2,3 \
 	  | sort -n \
@@ -391,7 +416,7 @@
 	  | uniq \
 	  > $@
 #	Comment out the next line if you are debugging.
-	rm munch[123].tmp
+#	rm munch[123].tmp
 
 
 norsk.mch: forkort.txt $(patsubst %,munched.%,${CATHEGORIES}) $(AFFIXES)
@@ -437,12 +462,16 @@
 # Remove all the line numbers that is found twice, and all words
 # containing xxxx and yyyy.  Those words didn't fit in in the munching,
 # and since it is few words I don't want to fiddle with them.
+# Note: Red Hat Linux 7.2's version of sort dumps core when empty file is
+#       passed, hence the '-s' test.  (6 Jun 2002, toralf@kscanners.com)
+
 	cat -n forkort.txt $(patsubst %,munched.%,${CATHEGORIES}) \
-	  | sort -n -m -s +0 -1  comp3.tmp - \
+	  | (if [ -s comp3.tmp ]; then sort -n -m -s +0 -1  comp3.tmp - ; else \
+	     cat -; fi)\
 	  | sed -e '/^[0-9]\+$$/,/.*/ D' -e '/\(xxxx\|yyyy\)\// D' \
 	  | tr -d '\- 	0-9' \
 	  > $@
-	rm -f comp.hash comp[123].tmp*
+#	rm -f comp.hash comp[123].tmp*
 
 # TODO:
 # If a rare word lies close to a common word, it might be wise to
@@ -456,7 +485,7 @@
 
 
 
-nynorsk.mch: norsk.words ny${AFFIXES}.munch
+nynorsk.mch: norsk.words.plain ny${AFFIXES}.munch
 	PATH=$(PATHADDER):$$PATH; \
 	export PATH; \
 	${CATNOHEADER} \
@@ -468,7 +497,7 @@
 		-e '$$ p' -e '$$ d' -e P -e D \
 	  > $@ 
 
-words.norsk: norsk.words
+words.norsk: norsk.words.plain
 # Here is a rule to make a list of the most common Norwegian words.
 # Which words to include is defined at the top of this Makefile.  Such
 # a file is needed to make the word competition work for Norwegian.
@@ -482,7 +511,7 @@
 	  | sort -f \
 	  > $@
 
-words.nynorsk: norsk.words
+words.nynorsk: norsk.words.plain
 # No frequency information availiable yet for nynorsk.  So all we can
 # do is poick the words marked with a star.
 	${CATNOHEADER} \
@@ -491,7 +520,7 @@
 	  > $@ 
 
 # Here is a target that picks words with given frequency.
-words.${LANGUAGE}.%: ${LANGUAGE}.words
+words.${LANGUAGE}.%: ${LANGUAGE}.words.plain
 	${CATNOHEADER} \
 	  | grep '[BANDS]$$' \
 	  | grep  ' $(patsubst words.${LANGUAGE}.%,%,$@) ' \
@@ -509,7 +538,7 @@
 	      ${DICTIONARY} ny${DICTIONARY} \
 	      ${AFFIXES} ny${AFFIXES} \
 	      ${AFFIXES}.munch ny${AFFIXES}.munch \
-	      comp[123].tmp*
+	      comp[123].tmp* *myspell* munched.* core*
 
 #	The following target is used in the English makefile, and is
 #	required to be present in all other language Makefiles as
